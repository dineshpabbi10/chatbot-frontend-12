name: Deploy Dev
on:
  push:
    branches:
      - dinesh
jobs:
  deploy-front-end:
    runs-on: ubuntu-latest
    steps:
    - name: Use ssh action to run linux commands
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        timeout: 600s
        command_timeout: 20m
        script: |
          ls -al
          cd /var/www/html
          rm -rf chatbot-frontend-12
          git clone https://${{ secrets.USER_NAME }}:${{ secrets.USER_TOKEN }}@github.com/dineshpabbi10/chatbot-frontend-12.git
          cd chatbot-frontend-12
          npm install
          npm install -g @angular/cli 
          ng build
          mv  -v ./dist/chatbot-frontend/* ../../
          cd ../../
          rm -rf chatbot-frontend-12
          ls -al



=========
name: Deploy Dev
on:
  push:
    branches:
      - dinesh
jobs:
  deploy-front-end:
    runs-on: ubuntu-latest
    steps:
    - name: checkout Repository
      uses: actions/checkout@v2

    - name: setup node 14
      uses: actions/setup-node@v2
      with:
        node-version: '14'
        cache: 'npm'
    
    - name: install node dependencies
      run: |
        npm install
        npm install -g @angular/cli
    
    - name: generate production build
      run: |
        ng build
        
    - name: move to production build folder
      run : |
        cd ./dist/chatbot-frontend/
    
    - name: install sshpass
      run: |
        sudo apt-get update -y
        sudo apt-get install -y sshpass

    - name: upload files
      run : |
        sshpass -p ${{ secrets.PASSWORD }} scp * ${{ secrets.USERNAME }}@${{ secrets.HOST }}:/var/www/html 

    - name: copy file via ssh password
      uses: appleboy/scp-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        timeout: 600s
        rm: true
        command_timeout: 20m
        source: "*"
        target: "/var/www/html"
